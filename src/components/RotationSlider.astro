---
interface Props {}

const {} = Astro.props;
---

<div
  id="rotationSlider"
  class="relative gap-2 px-4 py-5 flex items-center justify-center w-full z-[99999]"
>
  <!-- HORIZONTAL SLIDE -->
  <div class="relative z-10 w-full flex items-center justify-center">
    <p class="absolute left-6 text-[.75rem] font-medium text-zinc-100/50">0°</p>
    <input
      type="range"
      name="rotation"
      id="yRotationInput"
      min="-180"
      max="180"
      value="0"
      step="1"
    />
    <p class="absolute right-6 text-[.75rem] font-medium text-zinc-100/50">
      360°
    </p>
  </div>
</div>

<style>
  input[type="range"] {
    -webkit-appearance: none;
    background: transparent;
    cursor: pointer;
    width: 100%;
  }

  /***** Track Styles *****/
  /***** Chrome, Safari, Opera, and Edge Chromium *****/
  input[type="range"]::-webkit-slider-runnable-track {
    background: #053a5f;
    height: 1.3rem;
    border-radius: 1rem;
  }

  /******** Firefox ********/
  input[type="range"]::-moz-range-track {
    background: #053a5f;
    height: 1rem;
    border-radius: 1rem;
  }

  /***** Thumb Styles *****/
  /***** Chrome, Safari, Opera, and Edge Chromium *****/
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none; /* Override default look */
    appearance: none;
    margin-top: calc(1.3rem / 2 - 2rem / 2); /* Centers thumb on the track */
    background-color: #5cd5eb;
    height: 2rem;
    width: 2rem;
    border-radius: 50%;
    box-shadow: -2px -2px 6px #121212 inset;
  }
  input[type="range"]::-moz-range-thumb {
    -webkit-appearance: none; /* Override default look */
    appearance: none;
    margin-top: calc(1.3rem / 2 - 2rem / 2); /* Centers thumb on the track */
    background-color: #5cd5eb;
    height: 2rem;
    width: 2rem;
    border-radius: 50%;
    box-shadow: -2px -2px 6px #121212 inset;
  }
</style>

<script>
  let fadesDuration = 300;

  function degToRad(deg: number) {
    return (deg * Math.PI) / 180;
  }

  const celulaAnimalMarker = document.getElementById(
    "celulaAnimalMarker"
  ) as HTMLElement;
  const rotationSlider = document.getElementById(
    "rotationSlider"
  ) as HTMLElement;

  const yRotationInput = document.getElementById(
    "yRotationInput"
  ) as HTMLInputElement;

  const entity = celulaAnimalMarker.querySelector("a-entity") as any;

  let initialRotation = entity.object3D.rotation;

  window.addEventListener("DOMContentLoaded", () => {
    // rotationSlider.style.display = "none";
    /* setInterval(() => {
      celulaAnimalMarker.setAttribute("scale", {
        x: 1,
        y: 1,
        z: 1,
      } as unknown as string);
      console.log(celulaAnimalMarker.getAttribute("scale"));
    }, 100); */
  });

  celulaAnimalMarker.addEventListener("markerFound", (e) => {
    const target = e.target as HTMLElement;

    target.setAttribute(
      "animation",
      `property: scale; from: 0 0 0; to: 1 1 1; dur: ${fadesDuration}`
    );

    rotationSlider.style.display = "flex";
  });
  celulaAnimalMarker.addEventListener("markerLost", (e) => {
    const target = e.target as HTMLElement;

    target.setAttribute(
      "animation",
      `property: scale; from: 1 1 1; to: 0 0 0; dur: ${fadesDuration}`
    );

    (target as any).object3D.visible = true;

    let timer: ReturnType<typeof setTimeout>;

    timer = setTimeout(() => {
      rotationSlider.style.display = "none";
      (target as any).object3D.visible = false;

      clearTimeout(timer);
    }, fadesDuration);
  });

  yRotationInput.addEventListener("input", (e) => {
    const amount = parseInt((e.target as HTMLInputElement).value);

    const rads = degToRad(amount);
    entity.object3D.rotation.y = degToRad(90) + rads;
    celulaAnimalMarker.setAttribute("scale", {
      x: 1,
      y: 1,
      z: 1,
    } as unknown as string);
    // entity.object3D.scale.set(7, 7, 14);
  });
</script>
